<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>부스바 · 제품 상세 · 경기도, 김포, 화성, 서울, 인천, 포천, 남양주, 의정부</title>

  <!-- 파비콘: 브라우저 탭/바에 표시될 아이콘 -->
  <link rel="icon" type="image/png" sizes="32x32" href="/epmFavicon.png">
  <link rel="shortcut icon" href="/favicon.ico">

  <!-- ✅ SEO 기본 메타태그: 검색엔진 색인 품질 향상 -->
  <meta name="keywords" content="이스트파워메탈, 동버스바, 부스바, 분전반, 배전반, 수배전반, 무감전 분전반, 무감전 배전반, 무감전 변압기, 임가공, 절곡, 가공, 비철금속, 금속, 절단, 화성공장, 김포공장, 김포, 화성, 동부스바, 무감전, 누설전류">
  <meta name="description" content="이스트파워메탈은 부스바, 버스바, 동버스바, 분전반, 수배전반, 임가공 김포, 화성 다양한 품종과 맞춤 절단 서비스를 제공합니다.">
  <meta name="author" content="이스트파워메탈">
  <meta name="robots" content="index, follow">

  <!-- ✅ Open Graph (SNS 공유용 미리보기 메타) -->
  <meta property="og:title" content="이스트파워메탈:부스바, 동버스바, 분전반, 배전반, 임가공, 김포, 화성">
  <meta property="og:image" content="https://chkim-epm.github.io/EPM/factory.png">
  <meta property="og:url" content="https://www.eastpowermetal.com/">
  <meta property="og:type" content="website">

  <!-- ✅ 트위터 카드: 트위터 공유 시 미리보기 확장 -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="이스트파워메탈:부스바, 동버스바, 분전반, 배전반, 임가공, 김포, 화성">
  <meta name="twitter:description" content="이스트파워메탈은 부스바, 버스바, 동버스바, 분전반, 수배전반, 임가공 김포, 화성 다양한 품종과 맞춤 절단 서비스를 제공합니다.">
  <meta name="twitter:image" content="https://chkim-epm.github.io/EPM/factory.png">

  <!-- ✅ 네이버/OG 재정의: 일부 크롤러 호환성 목적 -->
  <meta property="og:title" content="이스트파워메탈:부스바, 동버스바, 분전반, 배전반, 임가공, 김포, 화성">
  <meta property="og:description" content="이스트파워메탈은 부스바, 버스바, 동버스바, 분전반, 수배전반, 임가공 김포, 화성 다양한 품종과 맞춤 절단 서비스를 제공합니다.">
  <meta property="og:image" content="https://www.eastpowermetal.com/logo.png">
  <meta property="og:url" content="https://www.eastpowermetal.com/">
  <meta property="og:type" content="website">

  <!-- ✅ 사이트 소유권 확인: 검색 콘솔/네이버 서치어드바이저 인증 -->
  <meta name="google-site-verification" content="google444cc8347990b8a8"/>
  <meta name="naver-site-verification" content="c2165f2b265182c8668d9374095a8bdcd78bf2c1" />

  <!-- 폰트 & 공통 CSS 로드 -->
  <link href="https://fonts.googleapis.com/css2?family=Nanum+Myeongjo:wght@700&family=Nanum+Gothic&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="common.css">

  <style>
    /* CSS 전역 토큰: 테마 색상 */
    :root{--accent:#23585C;--muted:#666;}
	
    /* 페이지 레이아웃 폭 및 패딩 */
    .container{max-width:1100px;margin:24px auto;padding:0 16px;}

    /* 상단 경로 표기(빵부스러기) 영역 */
    .breadcrumb{
      font-size:16px;font-weight:600;margin-bottom:16px;color:#2b3a3b;
      background:#f1f5f5;padding:10px 14px;border-radius:8px;
    }
    .breadcrumb a{color:#23585C;text-decoration:none;}
    .breadcrumb a:hover{text-decoration:underline;opacity:0.8;}

    /* 본문 2열 레이아웃: 좌(갤러리) 1.1 : 우(정보) 0.9 */
    .layout{display:grid;grid-template-columns:1.1fr .9fr;gap:22px}

    /* 이미지 갤러리 카드 스타일 */
    .gallery{background:#fff;border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,.06);padding:14px}

    /* 대표 이미지: 고정 높이 + cover로 깔끔한 자르기 */
    .mainimg{
      width:100%;height:clamp(420px, 62vh, 640px);
      object-fit:cover;border-radius:10px;background:#f2f2f2;
    }

    /* 썸네일 리스트: 가로 스크롤 가능 */
    .thumbs{display:flex;gap:8px;margin-top:10px;overflow-x:auto}
    .thumbs img{width:76px;height:76px;object-fit:cover;border-radius:8px;border:2px solid transparent;cursor:pointer;background:#f2f2f2}
    .thumbs img.active{border-color:var(--accent)}

    /* 우측 패널(제품 정보 박스) 공통 카드 스타일 */
    .panel{background:#fff;border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,.06);padding:18px}

    /* 제품명 타이틀 */
    h1{font-size:22px;margin:0 0 8px}

    /* 상세 설명 문단 */
    .desc{color:#444;line-height:1.6;margin:6px 0 16px}

    /* 스펙 테이블 */
    table{width:100%;border-collapse:collapse}
    th,td{border-bottom:1px solid #eee;padding:8px 6px;text-align:left;font-size:14px}
    th{width:120px;color:#333;background:#fafafa}

    /* 버튼 영역 */
    .actions{margin-top:14px;display:flex;gap:10px}
    .btn{padding:10px 14px;border:0;border-radius:10px;background:var(--accent);color:#fff;cursor:pointer}
    .ghost{background:#e9ecef;color:#111}
    .muted{color:var(--muted)}

    /* 반응형: 900px 이하에서 1열 레이아웃 */
    @media (max-width:900px){.layout{grid-template-columns:1fr}}
  </style>

  <!-- Supabase JS SDK (v2) 로드 -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

<!-- 네비게이션 바: 좌측 로고+상호, 우측 메뉴 -->
<nav>
<div class="nav-logo">
  <a href="index.html" style="text-decoration:none; color:inherit;">
  <!-- epm 코드 줄바꿈 하면 간격 생겨서 인라인으로 작성 -->
    <span class="logo-e" style="color:green;">E</span><span class="logo-p" style="color:red;">P</span><span class="logo-m" style="color:blue;">M</span>
	(주)이스트파워메탈
  </a>
</div>

 <div class="nav-menu">
	<!-- 홈 메뉴는 비활성 처리(주석) -->
	<!-- <div class="nav-item"><a href="index.html">HOME</a></div> -->
	<div class="nav-item"><a href="companyHistory.html">회사소개</a></div>
	<div class="nav-item"><a href="product.html">부스바</a></div>
	<!-- 제품목록 메뉴 예비(주석) -->
	<!-- <div class="nav-item"><a href="index.html">제품목록</a></div> -->
	<div class="nav-item"><a href="noElectrocution.html">무감전</a></div>
    <div class="nav-item"><a href="map.html">오시는 길</a></div>
</div>
</nav>

<!-- ✅ 네비게이션 끝 -->

<div class="container">
  <!-- 상단 경로: 목록 > 상세 -->
  <div class="breadcrumb"><a href="/product.html">제품 목록</a> <span class="muted">›</span> 상세</div>

  <div class="layout">
    <!-- 좌: 이미지 갤러리 카드 -->
    <div class="gallery">
      <!-- 메인 대표 이미지: 데이터 로드 후 src 채움 -->
      <img id="mainImg" class="mainimg" alt="제품 이미지">
      <!-- 썸네일 컨테이너: 동적 생성 -->
      <div id="thumbs" class="thumbs"></div>
    </div>

    <!-- 우: 스펙/설명 패널 -->
    <div class="panel">
      <!-- 제품명/설명/스펙: 데이터 로드 후 텍스트 삽입 -->
      <h1 id="title">제품명</h1>
      <div id="desc" class="desc">설명</div>
      <table>
        <tbody>
          <tr><th>재질</th><td id="material">-</td></tr>
          <tr><th>용도</th><td id="usage">-</td></tr>
          <tr><th>종류</th><td id="types">-</td></tr>
		   <tr style="display:none"><th>가격</th><td id="price">-</td></tr> <!-- 가격은 현재 숨김 처리 -->
        </tbody>
      </table>
      <div class="actions">
        <!-- 목록으로 복귀 버튼 -->
        <a class="btn" href="/product.html">이전으로</a>      
      </div>
      <!-- 상태 메시지(로딩/오류/완료) 표시 영역 -->
      <div id="status" class="muted" style="margin-top:8px;"></div>
    </div>
  </div>
</div>

<!-- 푸터: 회사 정보 표기 -->
<footer>
  <p>
	<span class="logo-e" style="color:green;">E</span>
	<span class="logo-p" style="color:red; ">P</span>
	<span class="logo-m" style="color:blue;">M</span>
   (주)이스트파워메탈 | 주소: 경기도 김포시 통진읍 율마로 223번길 42 | 전화: 031-985-6037 | 이메일: chkim.epm@gmail.com</p>
  <p>© 2025 EAST POWER METAL. All Rights Reserved.</p>
    <!-- 왼쪽 로고 -->
</footer>

<script>
  // ---------------------------
  // Supabase 설정 및 데이터 로딩
  // ---------------------------

  // Supabase 프로젝트 기본 URL 및 공개 anon 키
  // ※ anon 키는 퍼블릭 클라이언트에서 사용 가능하도록 권한이 제한된 공개 키입니다.
  const SUPABASE_URL = "https://cwwnarmrvpvjptytepdo.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN3d25hcm1ydnB2anB0eXRlcGRvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE4NzU4NTUsImV4cCI6MjA3NzQ1MTg1NX0.5mvgA_gKdlRaebVRSFIUJRKgp51zke_nffQ2jc8Ad1g";

  // Supabase 클라이언트 인스턴스 생성
  const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  // URL 쿼리스트링에서 제품 id 추출 (예: /productDetail.html?id=3)
  const params = new URLSearchParams(location.search);
  const pid = Number(params.get("id") || 0); // 숫자 변환, 없으면 0

  // DOM 헬퍼 & 상태 표시 노드 캐시
  const $ = (id)=>document.getElementById(id);
  const status = $("status");

  // 초기 로딩 함수: 제품 정보 + 이미지 목록을 Supabase에서 조회하여 화면 구성
  async function load() {
    if (!pid) { 
      // id가 없으면 잘못된 접근 처리
      status.textContent = "잘못된 접근입니다."; 
      return; 
    }
    status.textContent = "불러오는 중...";

    // 1) 제품 본문(product) 단건 조회
    //    - from("product").select("*").eq("id", pid).single()
    //    - id 컬럼이 pid인 레코드를 1건만 가져옴
    const { data: product, error: e1 } = await sb
      .from("product")
      .select("*")
      .eq("id", pid)
      .single();

    // 오류 또는 데이터 없음 처리
    if (e1 || !product) { 
      status.textContent = "제품을 찾을 수 없습니다."; 
      return; 
    }

    // 가져온 제품 데이터를 화면에 바인딩
    $("title").textContent = product.title || "-";
    $("desc").textContent  = product.description || "-";
    $("material").textContent = product.material || "-";
    $("usage").textContent    = product.usage || "-";
    $("types").textContent    = product.types || "-";
    $("price").textContent    = product.price ? Number(product.price).toLocaleString() : "-";

    // 2) 갤러리 이미지 구성
    //    - 대표 이미지(product.image_url) 우선 추가
    //    - 추가 이미지(product_image 테이블) 시간순으로 가져와 뒤에 이어 붙임
    const urls = [];
    if (product.image_url) urls.push(product.image_url);

    // 추가 이미지 목록 조회 (product_image.url)
    const { data: imgs, error: e2 } = await sb
      .from("product_image")
      .select("url")
      .eq("product_id", pid)
      .order("created_at", { ascending: true });

    // 오류가 없고 배열이면 url 이어 붙이기
    if (!e2 && Array.isArray(imgs)) {
      for (const { url } of imgs) if (url) urls.push(url);
    }

    // 이미지가 하나도 없는 경우/있는 경우 처리
    if (urls.length === 0) {
      $("mainImg").src = "";
      $("mainImg").alt = "이미지가 없습니다";
    } else {
      $("mainImg").src = urls[0]; // 첫 이미지를 대표로 표시
      renderThumbs(urls);         // 썸네일 렌더링
    }

    // 상태 메시지 초기화
    status.textContent = "";
  }

  // 썸네일 렌더링: 클릭 시 대표 이미지 교체 + 활성 표시 테두리
  function renderThumbs(urls) {
    const holder = $("thumbs");
    holder.innerHTML = ""; // 기존 썸네일 초기화

    urls.forEach((u, i) => {
      const img = document.createElement("img");
      img.src = u;
      if (i === 0) img.classList.add("active"); // 첫 썸네일 활성화 표시

      // 썸네일 클릭 시: 모든 썸네일에서 active 제거 후 현재만 active
      img.onclick = () => {
        document.querySelectorAll(".thumbs img").forEach(el => el.classList.remove("active"));
        img.classList.add("active");
        $("mainImg").src = u; // 대표 이미지 교체
      };
      holder.appendChild(img);
    });
  }

  // 페이지 로드 시 즉시 데이터 가져오기
  load();
</script>
</body>
</html>
