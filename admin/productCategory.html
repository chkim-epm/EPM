<!doctype html>
<html lang="ko" class="protecting">
<head>
<meta charset="utf-8" />
  <!-- âœ… ë°˜ì‘í˜•: ëª¨ë°”ì¼/íƒœë¸”ë¦¿/ë°ìŠ¤í¬í†±ì—ì„œ ì ì ˆí•œ ìŠ¤ì¼€ì¼ ìœ ì§€ -->
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- âš ï¸ admin ì˜ì—­ì€ ê²€ìƒ‰ ë…¸ì¶œ ê¸ˆì§€ -->
  <meta name="robots" content="noindex,nofollow" />

<!-- í˜ì´ì§€ ì œëª© -->
<title>ìƒí’ˆ ì¹´í…Œê³ ë¦¬ ê´€ë¦¬</title>
  
<script>
    /* =========================================================================
       0) www ì •ê·œí™” (ì„¸ì…˜ ì˜¤ë¦¬ì§„ í†µì¼)
       - ì¸ì¦ ì¿ í‚¤/í† í°ì€ ì˜¤ë¦¬ì§„(í”„ë¡œí† ì½œ+í˜¸ìŠ¤íŠ¸+í¬íŠ¸)ì— ì¢…ì†ë¨
       - wwwê°€ ì•„ë‹Œ ë„ë©”ì¸ìœ¼ë¡œ ì ‘ì† ì‹œ, ë™ì¼ ê²½ë¡œ/ì¿¼ë¦¬/í•´ì‹œë¥¼ ë³´ì¡´í•˜ì—¬
         https://www.eastpowermetal.com ìœ¼ë¡œ ê°•ì œ ì´ë™
       - ëª©ì : OAuth Redirect/ì„¸ì…˜ ì¼ê´€ì„±, CORS í˜¼ì„  ì˜ˆë°©
       ========================================================================= */
(function enforceWWW() {
  const CANON = "www.eastpowermetal.com";
  const allowed = [CANON, "eastpowermetal.com"];
  if (allowed.includes(location.hostname) && location.hostname !== CANON) {
    location.replace(`https://${CANON}${location.pathname}${location.search}${location.hash}`);
  }
})();

</script>

  <!-- íŒŒë¹„ì½˜ë“¤ -->
  <link rel="icon" type="image/png" sizes="32x32" href="/epmFavicon.png">
  <link rel="shortcut icon" href="/favicon.ico">
     
<!-- =========================
     ì „ì²´ í™”ë©´ ìŠ¤íƒ€ì¼ ì •ì˜
     í…Œì´ë¸”, ë²„íŠ¼, ëª¨ë‹¬ UI ë””ìì¸
========================= -->
<style>
/* í™”ë©´ ë³´í˜¸: ì¸ì¦/í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ í†µê³¼ ì „ê¹Œì§€ ë³¸ë¬¸ ìˆ¨ê¹€ */
html.protecting body { visibility: hidden; }
     
  :root { --bd:#e5e7eb; --txt:#111827; --mut:#6b7280; }
  body { font-family: Arial,"Malgun Gothic",sans-serif; margin:24px; color:var(--txt);}
  .wrap { max-width:1100px; margin:0 auto; }
  h1 { margin:0 0 10px; }
  .muted { color:var(--mut); font-size:12px; }
  .row { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
  .box { border:1px solid var(--bd); border-radius:12px; padding:14px; margin-top:12px; }
  label{ display:block; font-size:13px; margin:10px 0 6px;}
  input,select,textarea{ width:100%; padding:10px; border:1px solid #d1d5db; border-radius:10px;}
  textarea{min-height:90px;}
  .grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;}
  @media(max-width:900px){.grid{grid-template-columns:1fr;}}
  .btn{padding:10px 14px;border-radius:10px;border:1px solid #111;background:#111;color:#fff;cursor:pointer;}
  .btn.secondary{background:#fff;color:#111;}
  .btn.danger{background:#b91c1c;border-color:#b91c1c;}
  table{width:100%;border-collapse:collapse;margin-top:10px;}
  th,td{border-bottom:1px solid var(--bd);padding:10px;font-size:13px;}
  th{background:#fafafa;}
  .pill{padding:2px 10px;border-radius:999px;background:#f3f4f6;font-size:12px;}
  .mono{font-family:monospace;}
  .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;}
  .modal{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
    background:#fff;border:1px solid var(--bd);border-radius:14px;padding:14px;display:none;width:min(720px,92vw);}
</style>

<!-- Supabase JS SDK v2: ë¸Œë¼ìš°ì €ì—ì„œ ì¸ì¦/DB/ìŠ¤í† ë¦¬ì§€ ì‚¬ìš© -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>

<!-- =========================
     ë©”ì¸ í™”ë©´ ë ˆì´ì•„ì›ƒ
========================= -->
<div class="wrap">
<h1>ìƒí’ˆ ì¹´í…Œê³ ë¦¬ ê´€ë¦¬</h1>
<div class="muted">Supabase ì—°ê²° ë²„ì „</div>
</div>
  <!-- ìƒí’ˆí˜ì´ì§€ë¡œ ì´ë™-->
  <button class="ghost" id="toListBtn" type="button" onclick="location.href='/admin/product.html'">ìƒí’ˆ ëª©ë¡</button>
    <!-- ì‹ ê·œ ë“±ë¡: ê´€ë¦¬ì ìƒí’ˆ ì‘ì„± í˜ì´ì§€ë¡œ ì´ë™ -->
    <button class="btn" id="goAddProductBtn" onclick="location.href='/admin/addProduct.html'">ì‹ ê·œ ë“±ë¡</button>
    <!-- ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ -->
    <button class="btn ghost" id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</button>
</div>

<!-- ê²€ìƒ‰ / í•„í„° / ë²„íŠ¼ ì˜ì—­ -->
<div class="box">
  <div class="row">
    <input id="q" placeholder="ê²€ìƒ‰">
    <select id="useFilter">
      <option value="">ì‚¬ìš©ì—¬ë¶€(ì „ì²´)</option>
      <option value="Y">ì‚¬ìš©</option>
      <option value="N">ë¯¸ì‚¬ìš©</option>
    </select>
    <button class="btn secondary" id="reloadBtn">ìƒˆë¡œê³ ì¹¨</button>
    <button class="btn" id="addBtn">+ ì¹´í…Œê³ ë¦¬ ì¶”ê°€</button>
    <span id="countTxt" class="muted"></span>
  </div>

  <!-- ì¹´í…Œê³ ë¦¬ ëª©ë¡ í…Œì´ë¸” -->
  <table>
    <thead>
      <tr>
        <th>CategoryKey</th>
        <th>ì¹´í…Œê³ ë¦¬ëª…</th>
        <th>ì •ë ¬</th>
        <th>ì‚¬ìš©</th>
        <th>ê´€ë¦¬</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>
</div>
</div>

<!-- =========================
     ì¹´í…Œê³ ë¦¬ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ì°½
========================= -->
<div class="modal-backdrop" id="backdrop"></div>
<div class="modal" id="modal">
<h3 id="modalTitle"></h3>

<form id="form">
  <div class="grid">
    <div>
      <label>CategoryKey</label>
      <input id="CategoryKey" class="mono" required />
    </div>
    <div>
      <label>ì¹´í…Œê³ ë¦¬ëª…</label>
      <input id="CategoryName" required />
    </div>
    <div>
      <label>ì •ë ¬ìˆœì„œ</label>
      <input id="SortOrder" type="number" />
    </div>
  </div>

  <label>ì‚¬ìš©ì—¬ë¶€</label>
  <select id="UseYn">
    <option value="Y">Y</option>
    <option value="N">N</option>
  </select>

  <label>ë¹„ê³ </label>
  <textarea id="Remark"></textarea>

  <br><br>
  <button class="btn" type="submit" id="saveBtn">ì €ì¥</button>
  <button class="btn secondary" type="button" id="cancelBtn">ì·¨ì†Œ</button>
  <button class="btn danger" type="button" id="deleteBtn" style="display:none;">ì‚­ì œ</button>
</form>
</div>

<!-- =========================
     JavaScript ë¡œì§
========================= -->
<script>

/* =========================
   Supabase í”„ë¡œì íŠ¸ ì ‘ì† ì •ë³´
========================= */
const SUPABASE_URL = "https://cwwnarmrvpvjptytepdo.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN3d25hcm1ydnB2anB0eXRlcGRvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE4NzU4NTUsImV4cCI6MjA3NzQ1MTg1NX0.5mvgA_gKdlRaebVRSFIUJRKgp51zke_nffQ2jc8Ad1g";

/* Supabase REST API ì—”ë“œí¬ì¸íŠ¸
   - ì—°ê²° í…Œì´ë¸”ëª… : productCategory */
const API_BASE = `${SUPABASE_URL}/rest/v1/productCategory`;

/* Supabase ì¸ì¦ í—¤ë” */
const headers = {
  "apikey": SUPABASE_ANON_KEY,
  "Authorization": `Bearer ${SUPABASE_ANON_KEY}`,
  "Content-Type": "application/json",
  "Accept": "application/json"
};

/* ì „ì—­ ìƒíƒœê°’ */
let rows = [];
let editingId = null;
const $ = id => document.getElementById(id);

/* =========================
   ì¹´í…Œê³ ë¦¬ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° (SELECT)
========================= */
async function load(){
  $("reloadBtn").disabled = true;
  const res = await fetch(`${API_BASE}?select=*&order=sort_order.asc`, { headers });
  if(!res.ok){ alert("ì¡°íšŒ ì‹¤íŒ¨ : " + res.status); return; }
  const data = await res.json();

  rows = data.map(x => ({
    id:x.id,
    categoryKey:x.category_key,
    categoryName:x.category_name,
    sortOrder:x.sort_order,
    useYn:x.use_yn,
    remark:x.remark
  }));
  render();
  $("reloadBtn").disabled = false;
}

/* =========================
   í…Œì´ë¸” í™”ë©´ ì¶œë ¥
========================= */
function render(){
  const tbody = $("tbody");
  tbody.innerHTML = "";

  // ğŸ”¹ ê²€ìƒ‰ì–´ ì†Œë¬¸ì ë³€í™˜
  const q = $("q").value.trim().toLowerCase();

  // ğŸ”¹ ì‚¬ìš©ì—¬ë¶€ í•„í„° ê°’
  const useFilter = $("useFilter").value;

  // ğŸ”¹ rows â†’ í•„í„°ë§ëœ ëª©ë¡ ìƒì„±
  const filtered = rows.filter(r => {
    const key = (r.categoryKey || "").toLowerCase();
    const name = (r.categoryName || "").toLowerCase();

    // ê²€ìƒ‰ì–´ ì¡°ê±´
    const matchQ = !q || key.includes(q) || name.includes(q);

    // ì‚¬ìš©ì—¬ë¶€ ì¡°ê±´
    const matchUse = !useFilter || r.useYn === useFilter;

    return matchQ && matchUse;
  });

  // ğŸ”¹ í•„í„°ë§ëœ ê²°ê³¼ë¥¼ í…Œì´ë¸”ì— ì¶œë ¥
  filtered.forEach(r=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td class="mono">${r.categoryKey}</td>
      <td>${r.categoryName}</td>
      <td>${r.sortOrder}</td>
      <td><span class="pill">${r.useYn}</span></td>
      <td>
        <button class="btn secondary" onclick="editRow(${r.id})">ìˆ˜ì •</button>
        <button class="btn danger" onclick="deleteRow(${r.id})">ì‚­ì œ</button>
      </td>`;
    tbody.appendChild(tr);
  });

  // ğŸ”¹ ê±´ìˆ˜ í‘œì‹œ (í•„í„°ëœ ê±´ / ì „ì²´ ê±´)
  $("countTxt").textContent = `${filtered.length}ê±´ / ì „ì²´ ${rows.length}ê±´`;
}
     
// ğŸ”¹ ê²€ìƒ‰ì–´ ì…ë ¥ ì‹œ ì¦‰ì‹œ í…Œì´ë¸” ë‹¤ì‹œ ë Œë”ë§
$("q").addEventListener("input", render);
// ğŸ”¹ ì‚¬ìš©ì—¬ë¶€ ì„ íƒ ë³€ê²½ ì‹œ ì¦‰ì‹œ í…Œì´ë¸” ë‹¤ì‹œ ë Œë”ë§
$("useFilter").addEventListener("change", render);


/* =========================
   ëª¨ë‹¬ ì—´ê¸° / ë‹«ê¸°
========================= */
function openModal(){
  $("modalTitle").innerText = editingId ? "ì¹´í…Œê³ ë¦¬ ìˆ˜ì •" : "ì¹´í…Œê³ ë¦¬ ì¶”ê°€";
  $("backdrop").style.display="block";
  $("modal").style.display="block";
}

function closeModal(){
  $("backdrop").style.display="none";
  $("modal").style.display="none";
  editingId=null;
  $("form").reset();
}

/* ì‹ ê·œ ì¶”ê°€ ë²„íŠ¼ */
$("addBtn").onclick = ()=>{ editingId=null; openModal(); };

/* ìˆ˜ì • ë²„íŠ¼ í´ë¦­ */
window.editRow = (id)=>{
  const r = rows.find(x=>x.id==id);
  editingId = id;
  $("CategoryKey").value = r.categoryKey;
  $("CategoryKey").disabled = false;
  $("CategoryName").value = r.categoryName;
  $("SortOrder").value = r.sortOrder;
  $("UseYn").value = r.useYn;
  $("Remark").value = r.remark || "";
  openModal();
};

/* ì‚­ì œ ì²˜ë¦¬ (DELETE) */
window.deleteRow = async(id)=>{
  if(!confirm("ì‚­ì œí• ê¹Œìš”?")) return;
  await fetch(`${API_BASE}?id=eq.${id}`, { method:"DELETE", headers });
  load();
};

/* =========================
   ì €ì¥ ì²˜ë¦¬
   - editingId ì¡´ì¬ â†’ ìˆ˜ì •(PATCH)
   - editingId ì—†ìŒ â†’ ì‹ ê·œì¶”ê°€(POST)
========================= */
$("form").onsubmit = async(e)=>{
  e.preventDefault();

  const body = {
    category_key: $("CategoryKey").value.trim(),
    category_name: $("CategoryName").value.trim(),
    sort_order: Number($("SortOrder").value||0),
    use_yn: $("UseYn").value,
    remark: $("Remark").value.trim()
  };

  if(editingId){
    await fetch(`${API_BASE}?id=eq.${editingId}`, {
      method:"PATCH", headers, body:JSON.stringify(body)
    });
  } else {
    await fetch(API_BASE,{
      method:"POST", headers, body:JSON.stringify(body)
    });
  }

  closeModal();
  load();
};

/* ì·¨ì†Œ ë²„íŠ¼ */
$("cancelBtn").onclick = closeModal;

/* ìµœì´ˆ í˜ì´ì§€ ì§„ì… ì‹œ ë°ì´í„° ë¡œë“œ */
load();


/* ============================================================================
   ê´€ë¦¬ì í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ & ê²½ë¡œ
   - GitHub OAuth í›„ user.email ë˜ëŠ” user_metadata.user_nameë¥¼ ê¸°ì¤€ìœ¼ë¡œ í—ˆìš©
   - LOGIN_URL: ë¯¸ë¡œê·¸ì¸ ì‹œ ë³´ë‚¼ ë¡œê·¸ì¸ í˜ì´ì§€
   - DENIED_URL: ë¡œê·¸ì¸ì€ í–ˆìœ¼ë‚˜ ê¶Œí•œ ì—†ëŠ” ê³„ì •ì— ëŒ€í•œ ì°¨ë‹¨ í˜ì´ì§€
   ============================================================================ */
const ADMIN_EMAILS = ["chkim.epm@gmail.com"];
const ADMIN_USERNAMES = ["chkim-epm"];
const LOGIN_URL  = "/admin/index.html";   // ë¯¸ë¡œê·¸ì¸ ì‹œ
const DENIED_URL = "/admin/denied.html";  // ê¶Œí•œ ì—†ìŒ ì‹œ

/* ============================================================================
   Supabase ì´ˆê¸°í™”: ë¸Œë¼ìš°ì € í´ë¼ì´ì–¸íŠ¸ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
   ============================================================================ */
// â­ ì¿ í‚¤ ê¸°ë°˜ Session Storage (ëŒ€ìš©ëŸ‰ ëŒ€ì‘: ì¿ í‚¤ ìª¼ê°œì„œ ì €ì¥)
// - ë¸Œë¼ìš°ì € ì¢…ë£Œ ì‹œ íœ˜ë°œ: Expires/Max-Age ì—†ì´ "ì„¸ì…˜ ì¿ í‚¤"ë¡œ ì €ì¥
// - 1ì¿ í‚¤ 4KB ì œí•œ íšŒí”¼: keyë¥¼ key.0, key.1 ...ë¡œ ë¶„í•  ì €ì¥
const cookieStorage = (() => {
  const CHUNK_SIZE = 3000; // ì•ˆì „ ì—¬ìœ  (ì¿ í‚¤ ì˜¤ë²„í—¤ë“œ ê³ ë ¤)
   const OPTS = "path=/; SameSite=Lax; Domain=.eastpowermetal.com"; // âœ… ë³€ê²½: www/non-www ëª¨ë‘ì—ì„œ ì¿ í‚¤ ê³µìœ 

  const getCookie = (name) => {
    const m = document.cookie.match(new RegExp("(^| )" + name.replace(/[.*+?^${}()|[\]\\]/g, "\\$&") + "=([^;]+)"));
    return m ? decodeURIComponent(m[2]) : null;
  };

  const setCookie = (name, value) => {
    document.cookie = `${name}=${encodeURIComponent(value)}; ${OPTS}`;
  };

  const delCookie = (name) => {
     document.cookie = `${name}=; Max-Age=0; path=/; Domain=.eastpowermetal.com`; // âœ… ë³€ê²½: ì‚­ì œë„ ë™ì¼ ë„ë©”ì¸ ë²”ìœ„ë¡œ
  };

  return {
    getItem: (key) => {
      const meta = getCookie(`${key}.__chunks`);
      if (!meta) return getCookie(key); // (ê³¼ê±° ë‹¨ì¼ ì¿ í‚¤ í˜¸í™˜)
      const n = Number(meta);
      if (!Number.isFinite(n) || n <= 0) return null;

      let out = "";
      for (let i = 0; i < n; i++) {
        const part = getCookie(`${key}.${i}`);
        if (part == null) return null; // ì¤‘ê°„ ì¡°ê° ëˆ„ë½
        out += part;
      }
      return out;
    },

    setItem: (key, value) => {
      // ê¸°ì¡´ ì¡°ê° ì œê±°
      const old = getCookie(`${key}.__chunks`);
      if (old) {
        const nOld = Number(old);
        if (Number.isFinite(nOld) && nOld > 0) {
          for (let i = 0; i < nOld; i++) delCookie(`${key}.${i}`);
        }
        delCookie(`${key}.__chunks`);
      }
      delCookie(key); // ë‹¨ì¼ ì¿ í‚¤ ì“°ë˜ í”ì  ì œê±°

      // ë¶„í•  ì €ì¥
      const str = String(value ?? "");
      const chunks = [];
      for (let i = 0; i < str.length; i += CHUNK_SIZE) {
        chunks.push(str.slice(i, i + CHUNK_SIZE));
      }
      setCookie(`${key}.__chunks`, String(chunks.length));
      chunks.forEach((c, i) => setCookie(`${key}.${i}`, c));
    },

    removeItem: (key) => {
      const meta = getCookie(`${key}.__chunks`);
      if (meta) {
        const n = Number(meta);
        if (Number.isFinite(n) && n > 0) {
          for (let i = 0; i < n; i++) delCookie(`${key}.${i}`);
        }
        delCookie(`${key}.__chunks`);
      }
      delCookie(key);
    }
  };
})();


// 2) Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„±
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
  auth: {
    flowType: 'pkce',
    persistSession: true,
    autoRefreshToken: true,
    detectSessionInUrl: true,
    storage: cookieStorage,   // âœ… ì—¬ê¸°ë§Œ ë³€ê²½
    storageKey: 'epm-admin-auth'
  }
});
                                                                    

/* ============================================================================
   OAuth ë¦¬ë””ë ‰ì…˜ ì§í›„ ì„¸ì…˜ êµí™˜ ì²˜ë¦¬
   - Supabase OAuthëŠ” ë¦¬ë‹¤ì´ë ‰íŠ¸ ì‹œ URLì— code ë˜ëŠ” í•´ì‹œ í† í°ì„ ì²¨ë¶€
   - í•´ë‹¹ í† í°ì„ ì„¸ì…˜ìœ¼ë¡œ êµí™˜í•˜ì—¬ í˜„ì¬ íƒ­ì— ë¡œê·¸ì¸ ìƒíƒœë¥¼ í™•ë¦½
   ============================================================================ */
async function ensureSessionFromURL() {
  // detectSessionInUrl ì˜µì…˜ì´ ìë™ìœ¼ë¡œ ì„¸ì…˜ êµí™˜ ì²˜ë¦¬
  // ì—¬ê¸°ì„œëŠ” URLì— ë‚¨ì€ code/access_token í”ì ë§Œ ì œê±°
  if (location.search.includes("code=") || location.hash.includes("access_token")) {
    history.replaceState({}, document.title, location.pathname);
  }
}

/* ============================================================================
   í™”ë©´ ë³´í˜¸ ê°€ë“œ (ì¸ì¦ + í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ í™•ì¸)
   1) ì„¸ì…˜ ì¡°íšŒ â†’ user ì—†ìœ¼ë©´ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë³´ëƒ„
   2) ì´ë©”ì¼/ê¹ƒí—ˆë¸Œ ì‚¬ìš©ìëª… í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ê²€ì‚¬
   3) í†µê³¼ ì‹œ protecting í•´ì œ â†’ ë³¸ë¬¸ í‘œì‹œ
   ============================================================================ */
async function guardAdmin() {
  console.log("[guard] entered");
  
  let session;
try {
  console.log("[guard] before getSession");

  const timeout = (ms) =>
    new Promise((_, reject) =>
      setTimeout(() => reject(new Error("getSession timeout")), ms)
    );

  const { data, error } = await Promise.race([
    sb.auth.getSession(),
    timeout(2000) // âœ… 2ì´ˆ ì•ˆì— ì‘ë‹µ ì—†ìœ¼ë©´ íƒ€ì„ì•„ì›ƒ
  ]);

  console.log("[guard] after getSession", { data, error });
  if (error) throw error;
  session = data?.session;
} catch (e) {
  console.error("[guard] getSession error:", e);
  // âœ… í° í™”ë©´ ë°©ì§€: ì¼ë‹¨ í™”ë©´ì€ ì—´ì–´ë‘ê³  ìƒíƒœ í‘œì‹œ
  document.documentElement.classList.remove("protecting");
  
  return;
}


  const user = session?.user;
  if (!user) {
    console.log("[guard] no user -> kickLogin");
    return kickLogin();
  }

  const email = user.email;
  const ghUser = user.user_metadata?.user_name;

  console.log("[guard] email:", email, "ghUser:", ghUser);

  const ok =
    (email && ADMIN_EMAILS.includes(email)) ||
    (ghUser && ADMIN_USERNAMES.includes(ghUser));

  if (!ok) {
    console.log("[guard] not allowed -> kickDenied");
    return kickDenied();
  }

  
  document.documentElement.classList.remove("protecting");
}
  
/* ============================================================================
   ë¯¸ë¡œê·¸ì¸ ì²˜ë¦¬
   - í˜„ì¬ ìœ„ì¹˜ë¥¼ next íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬í•˜ì—¬ ë¡œê·¸ì¸ í›„ ì›ë˜ í˜ì´ì§€ë¡œ ë³µê·€ ê°€ëŠ¥
   ============================================================================ */
function kickLogin(){
  const next = encodeURIComponent(location.pathname + location.search + location.hash);
  location.replace(`${LOGIN_URL}?next=${next}`);
}

  /* ============================================================================
   ê¶Œí•œ ì—†ìŒ ì²˜ë¦¬
   - ë¡œê·¸ì¸ì€ í–ˆì§€ë§Œ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ë¯¸í†µê³¼ ê³„ì • â†’ denied í˜ì´ì§€
   ============================================================================ */
function kickDenied(){
  location.replace(DENIED_URL);
}

/* ============================================================================
   ì„¸ì…˜ ìƒíƒœ ë³€í™” ëŒ€ì‘
   - ë‹¤ë¥¸ íƒ­/ì°½ì—ì„œ ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ì‹œì—ë„ í˜„ì¬ í˜ì´ì§€ ê°€ë“œ ì¬í‰ê°€
   ============================================================================ */
sb.auth.onAuthStateChange(() => guardAdmin());

  /* ============================================================================
   ë¡œê·¸ì•„ì›ƒ
   - Supabase ì„¸ì…˜ í•´ì œ í›„ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™(ë³µê·€ ê²½ë¡œëŠ” indexì—ì„œ ì²˜ë¦¬)
   ============================================================================ */
$("logoutBtn").addEventListener("click", async ()=>{ await sb.auth.signOut(); location.replace(LOGIN_URL); });

     
</script>
</body>
</html>




